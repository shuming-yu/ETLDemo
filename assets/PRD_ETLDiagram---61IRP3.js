import{Q as E}from"./PopupDialog-KTqEVNw1.js";import{F as Q,H as $,aw as z,G as j,s as K,r as c,K as Z,L as R,M as r,P as L,R as f,O as T,N as s,Z as A,Q as D,U as I,T as d,ae as J,ax as W,ak as ee,al as oe}from"./index-DxvJ3q3h.js";import{Q as ae}from"./QPage-f7Z2Te5d.js";import{u as te,b as U}from"./ETLRelation.jsonvuetypei18nindex0srctruelang-DtymqJE6.js";import{a as se,u as de,_ as re,b as Te,E as ie,D as ne,c as _e,d as le,M as Ne}from"./DefaultNode-eBXDh45n.js";import{_ as ce}from"./plugin-vueexport-helper-DlAUqK2U.js";import"./Utils-CGTrpKBe.js";import"./QTable-miSyaNti.js";import"./QScrollObserver-Ca9sQzqY.js";import"./TouchPan-YrgtzC7q.js";import"./ETLInfo.jsonvuetypei18nindex0srctruelang-4JF1Bjs0.js";const Ee=[{NodeId:"00638689944685418294",ETLName:"END",Period:"",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:276,Y:372,Descr:"00638689944685419574",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},{NodeId:"00638689944685418330",ETLName:"INT_PRO_MONTHLY_PROCUREMENT_AMOUNT",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:-96,Y:60,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},{NodeId:"00638689944685418335",ETLName:"INT_PRO_PURCHASING_PART_ATTRIBUTE",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:207,Y:63,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},{NodeId:"00638689944685419500",ETLName:"INT_PRO_VENDOR_MASTER",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:479,Y:60,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},{NodeId:"00638689944685419574",ETLName:"DM_PRO_PURCHASING_MODE_AND_AMOUNT_DISTRIBUTION",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:126,Y:243,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1}],Re=[{LinkId:"00638689944685418330-00638689944685419574",SrcNodeId:"00638689944685418330",SrcNode:{NodeId:"00638689944685418330",ETLName:"INT_PRO_MONTHLY_PROCUREMENT_AMOUNT",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:-96,Y:60,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},DestNodeId:"00638689944685419574",DestNode:{NodeId:"00638689944685419574",ETLName:"DM_PRO_PURCHASING_MODE_AND_AMOUNT_DISTRIBUTION",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:126,Y:243,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},Level:2},{LinkId:"00638689944685418335-00638689944685419574",SrcNodeId:"00638689944685418335",SrcNode:{NodeId:"00638689944685418335",ETLName:"INT_PRO_PURCHASING_PART_ATTRIBUTE",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:207,Y:63,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},DestNodeId:"00638689944685419574",DestNode:{NodeId:"00638689944685419574",ETLName:"DM_PRO_PURCHASING_MODE_AND_AMOUNT_DISTRIBUTION",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:126,Y:243,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},Level:2},{LinkId:"00638689944685419500-00638689944685419574",SrcNodeId:"00638689944685419500",SrcNode:{NodeId:"00638689944685419500",ETLName:"INT_PRO_VENDOR_MASTER",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:479,Y:60,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},DestNodeId:"00638689944685419574",DestNode:{NodeId:"00638689944685419574",ETLName:"DM_PRO_PURCHASING_MODE_AND_AMOUNT_DISTRIBUTION",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:126,Y:243,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},Level:2},{LinkId:"00638689944685418330-00638689944685419574",SrcNodeId:"00638689944685418330",SrcNode:{NodeId:"00638689944685418330",ETLName:"INT_PRO_MONTHLY_PROCUREMENT_AMOUNT",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:-96,Y:60,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!0},DestNodeId:"00638689944685419574",DestNode:{NodeId:"00638689944685419574",ETLName:"DM_PRO_PURCHASING_MODE_AND_AMOUNT_DISTRIBUTION",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:126,Y:243,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},Level:3},{LinkId:"00638689944685419574-00638689944685418294",SrcNodeId:"00638689944685419574",SrcNode:{NodeId:"00638689944685419574",ETLName:"DM_PRO_PURCHASING_MODE_AND_AMOUNT_DISTRIBUTION",Period:"D",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:126,Y:243,Descr:"",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},DestNodeId:"00638689944685418294",DestNode:{NodeId:"00638689944685418294",ETLName:"END",Period:"",Version:"P",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:276,Y:372,Descr:"00638689944685419574",Editor:"IEC960919",Udt:"2024-12-05T11:21:21.253",Cdt:"2024-12-05T11:21:21.253",HasRelations:!1},Level:4}],De={Nodes:Ee,Links:Re},Ie={key:0,class:"row full-height"},Pe={class:"col q-px-xs full-height"},Me={class:"row q-pa-sm q-col-gutter-xs full-height"},Oe={class:"col-12 row items-center q-gutter-sm"},pe={class:"col"},me={class:"col-12 full-height",elevation:"10"},ue={class:"dnd-flow"},Le={key:0,class:"drop-text"},fe={class:"col-3 full-height"},Ae={class:"full-height"},C=Q({__name:"PRD_ETLDiagram",setup(Ue){const{t:_}=$(),P=z(),g=j(),t=te(),{onConnect:Ce,addEdges:ge,toObject:he,updateNode:ve,onNodeClick:h,onEdgeClick:v,onNodesChange:H,onEdgesChange:S,applyNodeChanges:Y,applyEdgeChanges:y}=se(),{onDragOver:w,onDragLeave:x,isDragOver:M}=de();K(()=>{t.Topic=P.query.topic,t.Version=P.query.version,t.Topic&&t.Version&&m(t.Topic,t.Version)});function V(){g.push("/ETL/ETLFlow/PRD")}const O=c([]),p=c([]);function b(a){return a==="END"?"end":"default"}function k(a,o){O.value=a.map(e=>({id:e.NodeId,label:e.ETLName,position:{x:parseFloat(e.X),y:parseFloat(e.Y)},type:b(e.ETLName),data:{...e,X:parseFloat(e.X),Y:parseFloat(e.Y),Color:e.HasRelations?"red":"black"}})),p.value=o.map(e=>({id:e.LinkId,source:e.SrcNodeId,target:e.DestNodeId,type:"smoothstep",markerEnd:Ne.ArrowClosed,data:{...e}}))}function m(a,o){""+new URLSearchParams({topic:a,version:o}).toString();let{Nodes:i,Links:n}=De;k(i,n)}let u=!1;H(async a=>{const o=[];for(const e of a)e.type==="remove"?t.ControlDeleteNode&&(o.push(e),t.ControlDeleteNode=!1):o.push(e);Y(o)}),S(async a=>{const o=[];for(const e of a)e.type==="remove"?u&&o.push(e):o.push(e);u=!1,y(o)});function B(){""+t.Topic,`${t.Topic}${t.Descr}`}let l=c();function G(a,o,e,i){""+new URLSearchParams({etlName:a,topic:o,period:e,nodeId:i}).toString(),l.value={NodeName:"INT_PRO_PURCHASING_PART_ATTRIBUTE",NodeId:"00638689944685418335",Period:"D",Topic:"PRO_DM_MATERIAL_MONTHLY_PROCUREMENT_AMOUNT",X:"0",Y:"0",Name:"INT_PRO_PURCHASING_PART_ATTRIBUTE",DataBaseName:"DGDEV",ExportName:"[sqlext].[ETL_INT_PRO_PURCHASING_PART_ATTRIBUTE_SP]",Type:"SP",Category:"DailyTask",OwnerEmail:"wen.vivian@inventec.com",Descr:"",Editor:"IEC960919",Udt:"2024-11-21T14:20:16.783",Cdt:"2024-11-21T14:20:16.783"}}let N=c();function X(a,o,e){""+new URLSearchParams({etlName:a,period:o,excludeTopic:e}).toString(),N.value={ID:14,ETLName:"INT_PRO_PURCHASING_PART_ATTRIBUTE",Period:"D",Before:"2024-10-31T00:00:00",FromPeriod:"2024-11-01T00:00:00",ToPeriod:"2025-03-06T00:00:00",After:"2025-03-07T00:00:00",UsageTime:2,ReturnCode:0,ErrorText:"",Category:"",Topic:"",Level:1,Dependence:"ODS_PRO_PART_MASTER(D)@PRO_INT_PART_ATTRIBUTE-P"}}h(({event:a,node:o})=>{let{ETLName:e,Topic:i,Period:n,NodeId:q}=o.data;if(e=="END"){l.value=void 0,N.value=void 0;return}e&&(G(e,i,n,q),X(e,n,i))}),v(({event:a,edge:o})=>{});function F(){m(t.Topic,t.Version),l.value=void 0,N.value=void 0}return(a,o)=>(R(),Z(ae,{class:"q-pa-sm bg-white page-height"},{default:r(()=>[a.$q.screen.lt.sm?f("",!0):(R(),L("div",Ie,[T("div",Pe,[s(A,{class:"no-shadow full-height",style:{overflow:"hidden"},bordered:""},{default:r(()=>[T("div",Me,[T("div",Oe,[s(D,{onClick:V,icon:"arrow_back",size:"md",round:"",flat:"",dense:"",class:"bg-grey-8 text-white"},{default:r(()=>[s(E,{class:"bg-grey-8 text-body2",anchor:"bottom middle",self:"top middle"},{default:r(()=>[T("strong",null,I(d(_)("ArrowBack")),1)]),_:1})]),_:1}),s(D,{onClick:B,icon:"sym_o_file_export",size:"md",round:"",flat:"",dense:"",class:"bg-indigo-8 text-white"},{default:r(()=>[s(E,{class:"bg-indigo-8 text-body2",anchor:"bottom middle",self:"top middle"},{default:r(()=>[T("strong",null,I(d(_)("Export")),1)]),_:1})]),_:1}),s(D,{onClick:F,icon:"refresh",size:"md",round:"",flat:"",dense:"",class:"bg-warning text-white"},{default:r(()=>[s(E,{class:"bg-warning text-body2",anchor:"bottom middle",self:"top middle"},{default:r(()=>[T("strong",null,I(d(_)("Refresh")),1)]),_:1})]),_:1}),T("div",pe,[s(J,{modelValue:d(t).Topic,"onUpdate:modelValue":o[0]||(o[0]=e=>d(t).Topic=e),label:d(_)("Topic"),outlined:"",readonly:"",dense:""},null,8,["modelValue","label"])])]),T("div",me,[T("div",ue,[s(d(re),{nodes:O.value,edges:p.value,onDragover:d(w),onDragleave:d(x),"apply-default":!1,"delete-key-code":"Delete","fit-view-on-init":""},{"node-default":r(e=>[s(ne,ee(oe(e)),null,16)]),"node-end":r(e=>[s(ie)]),default:r(()=>[s(Te,{class:"overlay",style:W({backgroundColor:d(M)?"#e7f3ff":"transparent",transition:"background-color 0.2s ease"})},{default:r(()=>[d(M)?(R(),L("p",Le,"Drop here")):f("",!0)]),_:1},8,["style"])]),_:1},8,["nodes","edges","onDragover","onDragleave"]),s(d(_e))])])])]),_:1})]),T("div",fe,[s(A,{class:"no-shadow full-height",bordered:""},{default:r(()=>[T("div",Ae,[s(le,{ETLNameInfo:d(l),ETLExecuteData:d(N)},null,8,["ETLNameInfo","ETLExecuteData"])])]),_:1})])]))]),_:1}))}});typeof U=="function"&&U(C);const Xe=ce(C,[["__scopeId","data-v-29e96b36"]]);export{Xe as default};
